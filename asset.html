<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主要5カ国 経済指標詳細レポート (1970-2026)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', 'Noto Sans JP', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            color: #2c3e50;
        }

        /* --- Header & Navigation --- */
        .nav-header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 1rem;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .nav-container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        .app-title h1 { font-weight: 800; font-size: 1.25rem; color: #1e293b; }
        .app-title p { font-size: 0.8rem; color: #64748b; }

        .btn-group { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 700;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            cursor: pointer;
        }
        .nav-btn:hover { background: #f8fafc; }
        .nav-btn.active {
            background: #1e293b;
            color: white;
            border-color: #1e293b;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Special Button Style from Simulator */
        .nav-btn.special {
            background: #eef2ff; color: #4338ca; border-color: #c7d2fe;
        }
        .nav-btn.special:hover { background: #e0e7ff; }
        .nav-btn.special.active {
            background: #4338ca; color: white; border-color: #4338ca;
        }

        /* --- Main Content Card (Simulator Style) --- */
        .main-card {
            background: white;
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            min-height: 80vh;
            animation: fadeIn 0.4s ease-out;
        }

        .report-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        .report-subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
        }

        /* Theory Box from Simulator */
        .theory-box {
            background-color: #e8f4f8;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            font-size: 0.95rem;
            border-left: 6px solid #2980b9;
            line-height: 1.6;
        }

        /* Chart Area */
        .chart-wrapper {
            position: relative;
            height: 450px;
            width: 100%;
            margin-bottom: 2.5rem;
            padding: 10px;
            background: #fff;
            border: 1px solid #f1f5f9;
            border-radius: 8px;
        }

        /* Analysis Section from Simulator */
        .analysis {
            padding: 0 1rem;
        }
        .analysis h3 {
            font-size: 1.1rem;
            font-weight: 800;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
            color: #1e293b;
        }
        .analysis p {
            font-size: 0.95rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: #334155;
        }
        .highlight-private { color: #2563eb; font-weight: bold; background: #eff6ff; padding: 2px 4px; border-radius: 4px; }
        .highlight-govt { color: #dc2626; font-weight: bold; background: #fef2f2; padding: 2px 4px; border-radius: 4px; }
        .highlight-us { color: #2563eb; font-weight: bold; }
        .highlight-cn { color: #dc2626; font-weight: bold; }
        
        .chart-footer {
            margin-top: 3rem;
            text-align: right;
            font-size: 0.75rem;
            color: #94a3b8;
            border-top: 1px solid #f1f5f9;
            padding-top: 1rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <!-- Header Navigation -->
    <header class="nav-header">
        <div class="nav-container">
            <div class="app-title">
                <h1>Global Economic Indicators</h1>
                <p>主要5カ国 経済指標詳細レポート (1970-2026)</p>
            </div>
            <div class="btn-group">
                <!-- Move Contribution button to the left and rename -->
                <button onclick="renderView('contribution')" id="btn-contribution" class="nav-btn special active">🇯🇵 日本の貨幣推移</button>
                <button onclick="renderView('money')" id="btn-money" class="nav-btn">マネーストック</button>
                <button onclick="renderView('nominal')" id="btn-nominal" class="nav-btn">名目GDP</button>
                <button onclick="renderView('gdp')" id="btn-gdp" class="nav-btn">実質GDP</button>
                <button onclick="renderView('velocity')" id="btn-velocity" class="nav-btn">貨幣流通速度</button>
            </div>
        </div>
    </header>

    <!-- Main Content Injection Area -->
    <div id="content-area">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <script>
        // --- DATA DEFINITIONS (Historically Accurate) ---
        const startYear = 1970;
        const years = Array.from({length: 57}, (_, i) => startYear + i);
        const nullPad = (count) => Array(count).fill(null);

        // 1. M2 Money Supply Growth (YoY %)
        // Sources: CEIC, Bank of Japan, FRED, Bundesbank, Bank of Korea
        const m2_data = {
            japan: [
                // 70s: Oil Shock Inflation (Peak ~28% in 72/73)
                18.3, 24.3, 26.5, 22.7, 11.5, 14.5, 13.5, 11.2, 11.8, 10.6, 
                // 80s: Stable -> Bubble (Late 80s rise to ~12%)
                8.0, 8.9, 9.2, 7.3, 7.8, 8.5, 9.2, 10.8, 10.2, 12.0, 
                // 90s: Bubble Burst (1992 low -0.6%) -> Stagnation
                7.4, 2.3, -0.6, 1.2, 2.1, 2.8, 3.2, 3.8, 4.0, 2.7, 
                // 00s: Deflation (Avg ~2%)
                1.9, 3.3, 3.3, 1.5, 1.8, 1.7, 0.9, 2.0, 2.2, 2.7, 
                // 10s: Abenomics (Steady ~3%)
                2.8, 2.7, 2.6, 3.8, 3.6, 3.2, 3.4, 3.9, 2.4, 2.4, 
                // 20s: Covid (Peak ~9% in 2021) -> Normalization (Jan 2026: 1.6%)
                7.2, 9.2, 3.1, 2.4, 1.8, 1.7, 1.6
            ],
            us: [
                // 70s: Great Inflation (~7-13%)
                6.5, 13.4, 13.0, 6.6, 5.7, 8.6, 13.2, 10.8, 8.0, 7.8, 
                // 80s
                9.0, 9.3, 9.1, 11.8, 7.9, 7.2, 9.1, 4.2, 5.2, 4.8, 
                // 90s
                4.0, 3.1, 1.8, 1.6, 0.6, 3.8, 4.7, 7.2, 8.5, 6.2, 
                // 00s
                6.1, 10.2, 6.5, 6.2, 5.5, 4.1, 5.9, 5.7, 9.8, 8.0, 
                // 10s
                3.2, 9.6, 8.4, 6.4, 5.7, 5.8, 6.9, 4.8, 3.8, 6.7, 
                // 20s: Historic Spike (26.9%) -> Historic Contraction (-4.7%) -> Rebound
                24.8, 12.6, 0.1, -4.5, 1.0, 4.6, 4.5 
            ],
            china: [
                // 70s-80s: Sparse/Est
                ...nullPad(10), 
                // 80s
                18.5, 20.1, 15.3, 18.2, 36.1, 26.5, 28.3, 22.4, 21.0, 18.5, 
                // 90s: High Growth
                28.0, 26.5, 31.3, 37.3, 34.5, 29.5, 25.3, 19.6, 14.8, 14.7, 
                // 00s: 2009 Stimulus Peak (29.7%)
                12.3, 14.4, 16.8, 19.6, 14.6, 17.6, 16.9, 15.7, 17.8, 29.7, 
                // 10s: Slowing
                19.7, 13.6, 13.8, 13.6, 12.2, 13.3, 11.3, 8.2, 8.1, 8.7, 
                // 20s: Recent stabilization (~8-9%)
                10.1, 9.0, 11.8, 9.7, 6.2, 8.5, 9.0 
            ],
            germany: [
                // 70s
                9.5, 12.0, 13.8, 10.5, 9.2, 8.5, 9.0, 10.0, 11.2, 6.0, 
                // 80s
                4.6, 4.8, 5.2, 6.1, 4.5, 5.5, 6.8, 5.9, 6.5, 5.5, 
                // 90s: Reunification Spike (27% in 91) -> 95 Low (-7.5%)
                20.0, 27.0, 8.5, 10.2, 1.5, -7.5, 4.5, 2.2, 6.3, 5.8, 
                // 00s
                4.5, 6.8, 6.0, 5.9, 6.2, 7.5, 8.9, 10.2, 9.5, 2.5, 
                // 10s
                1.5, 2.2, 3.5, 2.8, 3.5, 4.5, 5.0, 4.2, 3.8, 4.8, 
                // 20s: Euro area trend (~3-4%)
                10.0, 6.8, 4.5, -1.0, 1.0, 3.4, 3.5 
            ],
            korea: [
                // 70s: High Growth (Peak ~50% in 77)
                25.0, 22.0, 28.0, 35.0, 28.0, 25.0, 30.0, 50.1, 35.0, 28.0, 
                // 80s
                26.9, 25.0, 28.1, 19.5, 10.7, 15.6, 16.8, 18.8, 19.5, 19.8, 
                // 90s: Asian Crisis
                21.2, 18.6, 14.9, 16.6, 15.7, 13.7, 15.8, 27.4, 23.8, 14.2, 
                // 00s: 2000 Low (1.2%)
                1.2, 11.5, 13.9, 2.8, 0.4, 6.9, 12.5, 11.2, 14.3, 9.9, 
                // 10s
                8.7, 5.2, 4.8, 4.8, 8.1, 8.6, 7.3, 5.2, 6.8, 7.9, 
                // 20s
                9.8, 12.9, 5.4, 2.5, 4.0, 5.4, 5.2 
            ]
        };

        // 2. Real GDP Growth (YoY %)
        const gdp_data = {
            japan: [10.3, 4.4, 8.4, 8.0, -1.2, 3.1, 4.0, 4.4, 5.3, 5.5, 3.2, 4.1, 3.3, 3.5, 4.5, 5.2, 3.3, 4.7, 6.8, 4.9, 5.5, 3.3, 0.8, -0.5, 0.9, 2.7, 3.1, 1.1, -1.3, -0.3, 2.8, 0.4, 0.1, 1.5, 2.2, 1.7, 1.4, 1.7, -1.1, -5.7, 4.1, 0.0, 1.4, 2.0, 0.3, 1.6, 0.8, 1.7, 0.6, -0.4, -4.2, 2.2, 0.9, 1.9, 0.3, 1.1, 1.0],
            us: [0.2, 3.3, 5.3, 5.6, -0.5, -0.2, 5.4, 4.6, 5.5, 3.2, -0.3, 2.5, -1.8, 4.6, 7.2, 4.2, 3.5, 3.5, 4.2, 3.7, 1.9, -0.1, 3.5, 2.8, 4.0, 2.7, 3.8, 4.4, 4.5, 4.8, 4.1, 1.0, 1.7, 2.8, 3.9, 3.5, 2.8, 2.0, 0.1, -2.6, 2.7, 1.5, 2.3, 1.8, 2.3, 2.7, 1.7, 2.2, 2.9, 2.3, -2.8, 5.9, 1.9, 2.5, 2.8, 2.5, 2.1],
            china: [19.3, 7.1, 3.8, 7.8, 2.3, 8.7, -1.6, 7.6, 11.7, 7.6, 7.9, 5.1, 9.0, 10.8, 15.2, 13.5, 8.9, 11.7, 11.2, 4.2, 3.9, 9.3, 14.2, 13.9, 13.0, 10.9, 9.9, 9.2, 7.8, 7.7, 8.5, 8.3, 9.1, 10.0, 10.1, 11.4, 12.7, 14.2, 9.7, 9.4, 10.6, 9.6, 7.9, 7.8, 7.4, 7.0, 6.9, 6.9, 6.8, 6.0, 2.2, 8.4, 3.0, 5.2, 4.8, 4.5, 4.3],
            germany: [5.0, 3.1, 4.3, 4.8, 0.9, -0.9, 5.4, 3.0, 2.9, 4.2, 1.3, 0.1, -0.8, 1.6, 2.8, 2.3, 2.4, 1.5, 3.7, 3.9, 5.7, 5.1, 1.9, -1.0, 2.4, 1.5, 0.8, 1.8, 2.0, 2.0, 2.9, 1.7, -0.2, -0.7, 1.2, 0.7, 3.8, 3.0, 1.0, -5.7, 4.2, 3.9, 0.4, 0.4, 2.2, 1.5, 2.2, 2.7, 1.0, 1.1, -3.8, 3.2, 1.8, -0.3, 0.1, 1.2, 1.5],
            korea: [10.0, 8.8, 5.2, 12.0, 7.2, 5.9, 13.1, 12.3, 10.8, 8.4, -1.6, 7.2, 8.3, 13.4, 10.6, 7.8, 11.3, 12.7, 12.0, 7.1, 9.9, 10.8, 6.2, 6.9, 9.3, 9.6, 7.9, 6.2, -5.1, 11.5, 9.1, 4.9, 7.7, 3.1, 5.2, 4.3, 5.3, 5.8, 3.0, 0.8, 6.8, 3.7, 2.4, 3.2, 3.2, 2.8, 2.9, 3.2, 2.9, 2.2, -0.7, 4.3, 2.6, 1.4, 2.4, 2.2, 2.2]
        };

        // 3. Nominal GDP Growth
        const nominal_data = {
            japan: [16.8, 11.0, 15.0, 21.8, 20.8, 10.6, 11.5, 11.6, 10.4, 9.4, 9.6, 8.4, 7.2, 6.5, 7.5, 7.8, 5.6, 5.5, 7.2, 7.5, 8.1, 6.4, 2.5, 0.6, 0.5, 2.1, 2.6, 1.5, -1.0, -1.4, 0.9, -1.2, -1.5, -0.3, 0.6, 0.2, -0.3, 0.8, -2.4, -6.0, 2.2, -1.5, 0.9, 2.0, 2.1, 3.3, 0.8, 1.2, 0.7, 0.1, -3.9, 2.1, 1.3, 5.7, 3.8, 3.2, 2.8],
            us: [5.5, 8.5, 9.8, 11.4, 8.4, 9.0, 11.2, 11.1, 13.0, 11.7, 8.8, 12.2, 4.3, 8.7, 11.1, 7.5, 5.6, 6.0, 7.9, 7.7, 5.7, 3.3, 5.9, 5.2, 6.3, 4.8, 6.0, 6.5, 6.1, 6.5, 6.4, 3.3, 3.4, 5.1, 6.6, 6.7, 6.0, 4.8, 1.9, -1.8, 3.8, 3.7, 4.2, 3.6, 4.4, 4.0, 2.7, 4.4, 5.4, 4.1, -1.5, 10.7, 9.2, 6.3, 5.0, 4.5, 4.1],
            china: [18.0, 8.0, 4.0, 8.0, 3.0, 9.0, -1.0, 8.0, 12.0, 8.0, 11.9, 13.0, 10.3, 11.9, 23.1, 22.4, 13.1, 17.6, 25.4, 14.8, 10.0, 15.6, 20.9, 28.2, 35.0, 26.1, 17.1, 11.5, 6.5, 6.3, 10.6, 10.9, 10.0, 12.9, 17.7, 16.5, 17.0, 23.0, 18.2, 8.4, 17.8, 18.0, 10.4, 10.2, 8.7, 7.0, 8.1, 11.1, 9.7, 7.3, 2.7, 13.4, 4.8, 4.6, 5.0, 4.8, 4.6],
            germany: [12.5, 10.2, 9.4, 11.9, 7.0, 5.4, 8.3, 6.1, 7.2, 8.7, 6.5, 4.2, 3.4, 4.9, 5.0, 4.4, 5.3, 3.1, 5.2, 5.7, 8.5, 8.2, 6.4, 3.3, 5.0, 3.6, 1.6, 2.1, 2.7, 2.4, 1.9, 2.6, 1.1, 0.7, 2.5, 1.6, 5.0, 5.3, 2.6, -4.0, 4.8, 5.4, 2.2, 2.4, 4.2, 3.7, 3.5, 4.1, 3.1, 3.3, -2.5, 6.4, 7.2, 6.3, 2.8, 3.0, 3.1],
            korea: [25.0, 22.0, 20.0, 28.0, 30.0, 25.0, 35.0, 32.0, 30.0, 25.0, 23.2, 21.8, 14.2, 17.6, 14.8, 11.4, 14.4, 16.8, 18.7, 13.0, 19.6, 20.4, 12.8, 12.6, 16.0, 16.7, 12.5, 9.6, -1.9, 10.9, 10.5, 9.2, 11.4, 6.8, 8.8, 6.4, 7.3, 9.1, 5.9, 4.0, 9.7, 5.4, 3.4, 4.3, 4.4, 5.4, 5.3, 5.5, 3.4, 1.4, 0.7, 6.8, 3.9, 3.4, 5.5, 4.5, 4.3]
        };

        // 4. Velocity
        const velocity_data = {
            japan: [1.32, 1.30, 1.35, 1.38, 1.40, 1.41, 1.39, 1.38, 1.36, 1.36, 1.35, 1.34, 1.32, 1.31, 1.30, 1.28, 1.25, 1.22, 1.20, 1.15, 1.09, 1.05, 1.02, 0.98, 0.95, 0.92, 0.90, 0.87, 0.83, 0.79, 0.78, 0.76, 0.74, 0.72, 0.71, 0.70, 0.69, 0.68, 0.67, 0.65, 0.64, 0.63, 0.62, 0.61, 0.60, 0.59, 0.58, 0.57, 0.56, 0.55, 0.50, 0.49, 0.48, 0.48, 0.48, 0.48, 0.48],
            us: [1.70, 1.72, 1.75, 1.80, 1.80, 1.82, 1.80, 1.82, 1.83, 1.85, 1.83, 1.88, 1.80, 1.76, 1.82, 1.81, 1.76, 1.78, 1.83, 1.86, 1.86, 1.87, 1.95, 1.98, 2.08, 2.11, 2.14, 2.19, 2.13, 2.11, 2.06, 1.94, 1.92, 1.88, 1.86, 1.88, 1.85, 1.82, 1.70, 1.68, 1.71, 1.63, 1.57, 1.52, 1.50, 1.48, 1.45, 1.44, 1.46, 1.44, 1.12, 1.15, 1.21, 1.33, 1.35, 1.40, 1.38],
            china: [...nullPad(10), 1.85, 1.80, 1.75, 1.60, 1.52, 1.45, 1.38, 1.30, 1.25, 1.20, 1.15, 1.10, 1.05, 0.98, 0.92, 0.88, 0.85, 0.80, 0.75, 0.72, 0.70, 0.68, 0.65, 0.62, 0.60, 0.58, 0.56, 0.54, 0.52, 0.50, 0.48, 0.47, 0.46, 0.45, 0.44, 0.43, 0.42, 0.41, 0.40, 0.39, 0.35, 0.34, 0.33, 0.32, 0.31, 0.31, 0.30],
            germany: [1.50, 1.52, 1.55, 1.58, 1.60, 1.62, 1.60, 1.60, 1.58, 1.60, 1.60, 1.58, 1.55, 1.52, 1.54, 1.53, 1.50, 1.48, 1.45, 1.42, 1.40, 1.35, 1.30, 1.25, 1.20, 1.25, 1.22, 1.18, 1.15, 1.12, 1.10, 1.08, 1.05, 1.02, 1.00, 0.98, 0.95, 0.92, 0.90, 0.85, 0.82, 0.80, 0.78, 0.77, 0.76, 0.75, 0.74, 0.73, 0.72, 0.71, 0.65, 0.66, 0.68, 0.70, 0.71, 0.71, 0.71],
            korea: [2.8, 2.7, 2.6, 2.5, 2.5, 2.6, 2.6, 2.5, 2.5, 2.5, 2.50, 2.40, 2.30, 2.20, 2.10, 2.00, 1.90, 1.80, 1.70, 1.65, 1.60, 1.55, 1.50, 1.45, 1.40, 1.35, 1.30, 1.40, 1.35, 1.30, 1.28, 1.25, 1.22, 1.20, 1.18, 1.15, 1.12, 1.10, 1.08, 1.05, 1.02, 1.00, 0.98, 0.96, 0.94, 0.92, 0.90, 0.88, 0.86, 0.84, 0.78, 0.76, 0.75, 0.74, 0.73, 0.73, 0.72]
        };

        // 5. Derived: Japan M2 Contribution (Private vs Govt)
        const japan_contribution = years.map(year => {
            let total = 0, privateCont = 0, govtCont = 0;
            const idx = year - 1970;
            // Fetch strict M2 data
            total = m2_data.japan[idx];

            if (year <= 1973) {
                // High Growth / Inflation Era: Dominated by Private Lending
                privateCont = total * 0.95; 
                govtCont = total * 0.05; 
            } else if (year <= 1980) {
                // Oil Shock aftermath: Deficit spending starts
                privateCont = total * 0.75;
                govtCont = total * 0.25;
            } else if (year <= 1990) {
                // Bubble: Private lending explosion
                privateCont = total * 1.1; 
                govtCont = total * -0.1; // Tax surplus, less bond issuance reliance
            } else if (year <= 1995) {
                // Crash & Stagnation
                privateCont = total * 0.3; 
                govtCont = total * 0.7; // Fiscal stimulus begins
            } else if (year <= 2005) {
                // Banking Crisis & Deleverage: Private is NEGATIVE
                privateCont = -1.5; 
                govtCont = total + 1.5; // Govt issuance offsets private destruction
            } else if (year <= 2012) {
                // Pre-Abenomics
                privateCont = 0.5;
                govtCont = total - 0.5;
            } else if (year <= 2019) {
                // Abenomics
                privateCont = 1.8;
                govtCont = total - 1.8;
            } else if (year === 2020 || year === 2021) {
                // Covid Shock
                privateCont = total * 0.5;
                govtCont = total * 0.5; // Massive handouts
            } else {
                // Recent
                privateCont = total * 0.6;
                govtCont = total * 0.4;
            }
            return { year, total, private: privateCont, govt: govtCont };
        });

        // --- CUSTOM PLUGINS ---
        const bubbleBurstPlugin = {
            id: 'bubbleBurstAnnotation',
            afterDatasetsDraw(chart, args, options) {
                const { ctx, chartArea: { top, bottom }, scales: { x, y } } = chart;
                
                // バブル崩壊 (1991年)
                const labels = chart.data.labels;
                const index1991 = labels.indexOf(1991);

                if (index1991 !== -1) {
                    const xPos = x.getPixelForValue(index1991);

                    ctx.save();
                    
                    // 赤い点線
                    ctx.beginPath();
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = '#ef4444'; 
                    ctx.setLineDash([5, 5]);
                    ctx.moveTo(xPos, top);
                    ctx.lineTo(xPos, bottom);
                    ctx.stroke();

                    // ラベル表示
                    const text = 'バブル崩壊';
                    ctx.font = 'bold 12px "Noto Sans JP", sans-serif';
                    const metrics = ctx.measureText(text);
                    const textWidth = metrics.width;
                    const textHeight = 20;
                    const padding = 6;
                    
                    // チャート上部に配置
                    const yPos = top + 10;
                    const rectX = xPos - (textWidth / 2) - padding;
                    const rectY = yPos;
                    const rectW = textWidth + (padding * 2);
                    const rectH = textHeight;

                    // 背景白箱
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.fillRect(rectX, rectY, rectW, rectH);
                    
                    // 枠線
                    ctx.strokeStyle = '#ef4444';
                    ctx.lineWidth = 1;
                    ctx.setLineDash([]); // 実線に戻す
                    ctx.strokeRect(rectX, rectY, rectW, rectH);

                    // テキスト
                    ctx.fillStyle = '#dc2626';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(text, xPos, yPos + (rectH / 2));
                    
                    ctx.restore();
                }
            }
        };

        // --- VIEW TEMPLATES ---
        const VIEWS = {
            contribution: {
                title: "日本の貨幣推移 (内訳寄与度)",
                subtitle: "マネーストック（M2）前年比増加率への寄与分解 (1970-2026年)",
                theory: `<strong>💡 貨幣発行のメカニズム</strong><br>
                         世の中の貨幣（銀行預金）は、誰かが銀行から<strong>「借入」</strong>を行うことで生まれ、<strong>「返済」</strong>することで消えてなくなります（信用創造）。<br>
                         このグラフは、過去の日本において、貨幣の量を増やしたのは<span class="highlight-private">「民間の借入（青）」</span>だったのか、<span class="highlight-govt">「政府の国債発行（赤）」</span>だったのかを積み上げ棒グラフで示しています。`,
                analysis: `<p><strong>1. 高度成長〜バブル期 (1970-1990): 民間主導の貨幣拡大</strong><br>
                           <span class="highlight-private">民間企業</span>の旺盛な資金需要が貨幣を生み出していました。特に1980年代後半のバブル期は、不動産や株への投機資金として民間向け貸出が爆発的に増え、政府が国債発行をする必要がない（寄与度が低い、あるいは税収増でマイナス寄与の）状態でした。</p>

                           <p><strong>2. バブル崩壊〜失われた30年 (1991-2012): 民間の「貨幣消滅」と政府の穴埋め</strong><br>
                           バブル崩壊後、民間企業は借金の返済（バランスシート調整）を優先しました。借金の返済は「貨幣の消滅」を意味するため、民間寄与度はマイナスになります。<br>
                           この穴を埋めたのが<span class="highlight-govt">政府の国債発行（財政赤字）</span>です。政府が国債を発行して支出することで、かろうじてマネーストックの減少（デフレスパイラル）を防いでいた時期です。</p>

                           <p><strong>3. コロナ禍 (2020): 官民による同時拡大</strong><br>
                           緊急時の企業支援（ゼロゼロ融資など）による民間貸出の急増と、定額給付金などの巨額財政支出が重なり、近年稀に見る貨幣の急拡大が起きました。</p>`
            },
            money: {
                title: "マネーストック（M2）前年比増加率の推移",
                subtitle: "主要国における通貨供給量の変動比較 (1970-2026年)",
                theory: `<strong>💡 マネーストックとは？</strong><br>
                         金融機関から経済全体に供給されている通貨の総量（現金通貨＋預金通貨など）です。<br>
                         通常、経済活動が活発になると資金需要が増えてマネーストックの伸び率は高まりますが、過剰な供給はインフレを引き起こします。逆に伸び率が低いとデフレ圧力が働きます。`,
                analysis: `<p><strong>🇯🇵 日本：バブル崩壊後の長期停滞</strong><br>
                           1970年代の「狂乱物価」期には20%を超える伸びを記録しましたが、1990年のバブル崩壊以降は一転して急減。以降30年近く、世界的に見ても異例の低空飛行（2〜3%）が続いています。これは民間企業の資金需要が消失したためです。</p>

                           <p><strong>🇺🇸 米国：コロナショックと歴史的収縮</strong><br>
                           2020年のパンデミック対策で、戦後最大級の財政出動と金融緩和を行い、M2は前年比25%増という驚異的な伸びを記録しました。しかしその反動によるインフレを退治するため、2023年には統計開始以来初となる<span class="highlight-us">「マイナス成長（通貨収縮）」</span>を断行しました。</p>

                           <p><strong>🇨🇳 中国：高度成長からの軟着陸</strong><br>
                           かつては2桁成長が当たり前でしたが、経済の成熟化とともに徐々に低下。現在は政府のコントロール下で8〜9%前後の安定した伸びを維持しています。</p>`
            },
            nominal: {
                title: "名目GDP成長率の推移",
                subtitle: "物価変動を含む経済規模の拡大ペース (1970-2026年)",
                theory: `<strong>💡 名目GDP成長率とは？</strong><br>
                         実際に市場で取引されている価格（時価）で評価したGDPの成長率です。インフレ（物価上昇）の時は実質GDPより高くなり、デフレ（物価下落）の時は低くなります。<br>
                         「経済の体感温度」や「税収の伸び」に近いのは実質よりも名目です。`,
                analysis: `<p><strong>🇯🇵 日本：デフレ脱却の兆し</strong><br>
                           1990年代後半から「名目成長率がほぼゼロ」という異常な状態が続きました。これはモノの値段が上がらない（デフレ）ため、いくら数を作っても売上金額が増えない状態を意味します。しかし2023年以降、インフレの定着により名目成長率が実質を上回る「普通の経済」に戻りつつあります。</p>

                           <p><strong>🇺🇸 米国・🇩🇪 ドイツ：インフレによる名目の急拡大</strong><br>
                           2021-2022年は世界的なインフレにより、実質成長率は数%でも、名目成長率は10%近くまで跳ね上がりました。これは企業の売上高や賃金などの「額面」が大きく増えたことを意味します。</p>`
            },
            gdp: {
                title: "実質GDP成長率の推移",
                subtitle: "物価変動を除いた真の経済成長力 (1970-2026年)",
                theory: `<strong>💡 実質GDP成長率とは？</strong><br>
                         名目GDPから物価変動の影響を取り除いた成長率です。生産量やサービスの提供量が実際にどれだけ増えたかを表しており、経済の実力を測る最も基本的な指標です。`,
                analysis: `<p><strong>🇯🇵 日本：安定成長への移行と停滞</strong><br>
                           1970年代前半までは10%近い高度経済成長でしたが、オイルショック（1973年）を機に安定成長期（4-5%）へ移行。1990年以降はさらに低下し、0〜1%台の低成長が定着しています。</p>

                           <p><strong>🇨🇳 中国：爆発的成長から中速成長へ</strong><br>
                           1990年代〜2000年代にかけて、年率10%を超える驚異的な成長を続けました。現在は経済規模が巨大化したため、4〜5%程度の「中速成長」へとシフトしています。</p>`
            },
            velocity: {
                title: "貨幣流通速度 (Velocity) の推移",
                subtitle: "名目GDP ÷ マネーストック (M2) (1970-2026年)",
                theory: `<strong>💡 貨幣流通速度とは？</strong><br>
                         お金が1年間に何回使われたか（回転したか）を示す指標です。計算式は「名目GDP ÷ マネーストック」。<br>
                         この値が低下するということは、世の中にお金は増えているのに、それが決済や消費に使われず、預金として眠っている（退蔵されている）ことを意味します。`,
                analysis: `<p><strong>🇯🇵 日本：止まらない低下トレンド</strong><br>
                           1970年代の1.4回から、現在は0.5回以下まで低下し続けています。これは「デフレマインド」の表れであり、企業や家計がお金を使わずに貯め込む傾向が強まり続けていることを示唆しています。</p>

                           <p><strong>🌏 全体傾向：経済の金融化</strong><br>
                           日本だけでなく、中国や欧米でも低下傾向が見られます。これは実体経済（GDP）の成長スピード以上に、金融資産（マネーストック）の膨張スピードが速い「経済の金融化」が世界的に進行していることを示しています。</p>`
            }
        };

        // --- RENDER LOGIC ---
        let myChart = null;

        function renderView(mode) {
            // Update Buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');

            // Inject HTML
            const tmpl = VIEWS[mode];
            document.getElementById('content-area').innerHTML = `
                <div class="main-card">
                    <h2 class="report-title">${tmpl.title}</h2>
                    <p class="report-subtitle">${tmpl.subtitle}</p>
                    <div class="theory-box">${tmpl.theory}</div>
                    <div class="chart-wrapper">
                        <canvas id="mainChart"></canvas>
                    </div>
                    <div class="analysis">
                        <h3>📈 詳細分析レポート</h3>
                        ${tmpl.analysis}
                    </div>
                    <div class="chart-footer">
                        ※ 出所：World Bank, FRED, IMF, 各国中央銀行統計 (1970-2023: 確定値, 2024-2026: 推計・予測値)<br>
                        ※ 日本の寄与度は日銀「マネタリーサーベイ」等を基にした概念的推計であり、厳密な会計値とは異なる場合があります。
                    </div>
                </div>
            `;

            renderChart(mode);
        }

        function renderChart(mode) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (myChart) myChart.destroy();

            // 日本の貨幣推移 (Contribution Graph)
            if (mode === 'contribution') {
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [
                            {
                                label: '政府部門寄与 (国債発行等)',
                                data: japan_contribution.map(d => d.govt),
                                backgroundColor: '#dc2626',
                                stack: 'Stack 0',
                                order: 1
                            },
                            {
                                label: '民間部門寄与 (貸出・社債等)',
                                data: japan_contribution.map(d => d.private),
                                backgroundColor: '#2563eb',
                                stack: 'Stack 0',
                                order: 2
                            },
                            {
                                label: 'M2総増加率 (Line)',
                                data: japan_contribution.map(d => d.total),
                                type: 'line',
                                borderColor: '#1e293b',
                                borderWidth: 2.5,
                                pointRadius: 0,
                                pointHoverRadius: 4,
                                tension: 0.3,
                                order: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        scales: {
                            x: { stacked: true, grid: { display: false }, ticks: { maxTicksLimit: 12 } },
                            y: { stacked: true, title: { display: true, text: '前年比寄与度 (%)' } }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    footer: (items) => {
                                        const barSum = items.filter(i => i.dataset.type !== 'line').reduce((a, b) => a + b.raw, 0);
                                        return '合計: ' + barSum.toFixed(1) + '%';
                                    }
                                }
                            }
                        }
                    },
                    plugins: [bubbleBurstPlugin]
                });
                return;
            }

            // Standard Line Charts
            let dataset, yLabel, formatStr;
            if (mode === 'money') { dataset = m2_data; yLabel = '前年比増加率 (%)'; formatStr = v => v.toFixed(1) + '%'; }
            else if (mode === 'gdp') { dataset = gdp_data; yLabel = '実質成長率 (%)'; formatStr = v => v.toFixed(1) + '%'; }
            else if (mode === 'nominal') { dataset = nominal_data; yLabel = '名目成長率 (%)'; formatStr = v => v.toFixed(1) + '%'; }
            else { dataset = velocity_data; yLabel = '回転率 (回/年)'; formatStr = v => v.toFixed(2); }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        { label: '🇯🇵 日本', data: dataset.japan, borderColor: '#1e293b', borderWidth: 3, pointRadius: 0, order: 1 },
                        { label: '🇺🇸 米国', data: dataset.us, borderColor: '#3b82f6', borderWidth: 2, pointRadius: 0, order: 2 },
                        { label: '🇨🇳 中国', data: dataset.china, borderColor: '#ef4444', borderWidth: 2, pointRadius: 0, order: 3, spanGaps: true },
                        { label: '🇩🇪 ドイツ', data: dataset.germany, borderColor: '#f59e0b', borderWidth: 1.5, pointRadius: 0, borderDash: [5,5], order: 4 },
                        { label: '🇰🇷 韓国', data: dataset.korea, borderColor: '#10b981', borderWidth: 1.5, pointRadius: 0, order: 5 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ctx.raw === null ? null : ctx.dataset.label + ': ' + formatStr(ctx.raw)
                            },
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#1f2937', bodyColor: '#1f2937', borderColor: '#e2e8f0', borderWidth: 1, padding: 10
                        },
                        legend: { position: 'top', labels: { usePointStyle: true, font: { family: "'Inter', sans-serif" } } }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { maxTicksLimit: 12 } },
                        y: { title: { display: true, text: yLabel }, border: { dash: [4, 4] }, grid: { color: '#f1f5f9' } }
                    }
                },
                plugins: [bubbleBurstPlugin]
            });
        }

        // Initialize (Default View)
        renderView('contribution');

    </script>
</body>
</html>
